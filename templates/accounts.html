{% extends "base.html" %}
{% block title %}Accounts - Budget App{% endblock %}

{% block content %}
<div style="margin-bottom: 20px;">
  <a href="{{ url_for('main.home') }}" style="text-decoration: none; color: #667eea; font-weight: bold;">‚Üê Back to Dashboard</a>
</div>

<h1>Accounts</h1>

<!-- ‚îÄ‚îÄ Automatic accounts (Plaid) ‚îÄ‚îÄ -->
<h2>Connected Banks</h2>
{% if items %}
  {% for item in items %}
    <div style="background: #f9f9f9; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
      <div style="display: flex; justify-content: space-between; align-items: center;">
        <div>
          <strong>üè¶ {{ item.institution_name }}</strong>
          <span style="color: #888; font-size: 13px; margin-left: 12px;">
            Last synced: {{ item.last_synced_at.strftime('%d %b %Y %H:%M') if item.last_synced_at else 'Never' }}
          </span>
        </div>
        <form action="/plaid/sync" method="post">
          <input type="hidden" name="item_id" value="{{ item.id }}">
          <button type="submit" style="background: #667eea; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">
            üîÑ Sync Now
          </button>
        </form>
      </div>
      {% if item.accounts %}
        <table style="width: 100%; border-collapse: collapse; margin-top: 15px;">
          <thead>
            <tr style="background: #eee;">
              <th style="padding: 8px; text-align: left;">Account</th>
              <th style="padding: 8px; text-align: left;">Type</th>
              <th style="padding: 8px; text-align: left;">Mask</th>
              <th style="padding: 8px; text-align: left;">Balance</th>
            </tr>
          </thead>
          <tbody>
            {% for acct in item.accounts %}
              <tr style="border-top: 1px solid #eee;">
                <td style="padding: 8px;">{{ acct.name }}</td>
                <td style="padding: 8px;">{{ acct.subtype }}</td>
                <td style="padding: 8px;">‚Ä¢‚Ä¢‚Ä¢‚Ä¢ {{ acct.mask }}</td>
                <td style="padding: 8px;">
                  {% if acct.latest_balance %}
                    {{ acct.currency }} {{ "%.2f"|format(acct.latest_balance.current_balance|float) }}
                  {% else %}‚Äî{% endif %}
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      {% endif %}
    </div>
  {% endfor %}
{% else %}
  <p>No banks connected. <a href="{{ url_for('plaid.plaid_connect') }}">Connect a bank</a></p>
{% endif %}

<!-- ‚îÄ‚îÄ Manual accounts ‚îÄ‚îÄ -->
<h2>Manual Accounts</h2>
<div style="margin-bottom: 15px;">
  <a href="{{ url_for('accounts.new_account') }}" style="background: #667eea; color: white; padding: 8px 16px; border-radius: 4px; text-decoration: none;">+ Add Manual Account</a>
</div>
{% if manual_accounts %}
  <table style="width: 100%; border-collapse: collapse;">
    <thead>
      <tr style="background: #eee;">
        <th style="padding: 8px; text-align: left;">Name</th>
        <th style="padding: 8px; text-align: left;">Currency</th>
        <th style="padding: 8px; text-align: left;">Expenses shown as</th>
        <th style="padding: 8px; text-align: left;">Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for acct in manual_accounts %}
        <tr style="border-top: 1px solid #eee;">
          <td style="padding: 8px;">{{ acct.name }}</td>
          <td style="padding: 8px;">{{ acct.currency }}</td>
          <td style="padding: 8px;">
            {% if acct.invert_amounts == true %}
              Negative (e.g. -50.00)
            {% elif acct.invert_amounts == false %}
              Positive (e.g. 50.00)
            {% else %}
              Unknown
            {% endif %}
          </td>
          <td style="padding: 8px;">
            <a href="{{ url_for('accounts.edit_account', id=acct.id) }}">Edit</a>
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
{% else %}
  <p style="color: #888;">No manual accounts yet.</p>
{% endif %}

{% endblock %}
